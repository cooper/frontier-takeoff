<!doctype html>
<html>
<head>
<meta name="studentconfig" contents="{ 'lcs_host': '172.16.1.73', 'lcs_port': 8080, 'channel': 1228, 'change_channel': false, 'allow_prefs': false }" />
<title>Frontier Takeoff</title>
<script type="text/javascript" src="mootools.js"></script>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    var announcementsQueryURL = 'https://docs.google.com/a/frontier.k12.in.us/spreadsheets/d/1WdvyXz6LbB12GknlRO0QY8vFHTkCX4zoHkQ6i10Xcfw/gviz/tq?tq=',
        mealsQueryURL = 'https://docs.google.com/a/frontier.k12.in.us/spreadsheets/d/1a2G6_26ygUNKcFdf90SQYV9noIUvaTufkcBUo6s0zBs/gviz/tq?tq=';
    
    // this is basically a trick to avoid using Google's huge APIs for something so simple.
    var google = { visualization: { Query: {
        setResponse: function (res) { handleResponse(res); } 
    } } };
    
    
    var d = new Date(),
        dateStr = d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate();
    
    function injectAnnouncementsRequest () {
        var query = "select * where D=date '"+dateStr+"' order by A desc limit 1";
        
        // inject a script tag for Google's spreadsheet APIs.
        var script  = new Element('script', {
            src:  announcementsQueryURL + encodeURIComponent(query),
            type: 'text/javascript'
        });
        document.head.adopt(script);
        
    }
    
    function injectMealsRequest () {
        var query = "select * where F=date '"+dateStr+"' order by A desc limit 1";
        
        // inject a script tag for Google's spreadsheet APIs.
        var url = mealsQueryURL + encodeURIComponent(query);
        var script  = new Element('script', {
            src:   url,
            type: 'text/javascript'
        });
        
        document.head.adopt(script);
    }
    
    function handleResponse (res) {
        
        // some error occurred.
        if (res.status != 'ok') return;
        
        if (res.table.cols[1].label == 'General announcements')
            handleAnnouncementsResponse(res);
        else
            handleMenuResponse(res);
    }
    
    function handleAnnouncementsResponse (res) {
        var announcements = $('to-announcements'),
            meetings      = $('to-meetings');
        
        // consider: if not logged in, this will be a redirect...
        // how will Chrome handle a <script> tag leading to text/html?
        // probably just won't do anything.
                
        // the row will be the first and only row, since the query
        // limits to one result.
        var row = res.table.rows[0];
        if (!row) return;
         
        // 0 (A) Timestamp
        // 1 (B) Announcements
        // 2 (C) Username
        // 3 (D) Date for announcements
        // 4 (E) Meetings
        
        // the date is not today.
        if (row.c[3].v.toDateString() != new Date().toDateString())
            return;
        
        announcements.innerText = row.c[1].v;
        meetings.innerText = row.c[4].v;
        
        // only show meetings if there are any.
        if (meetings.innerText) {
            meetings.setStyle('display', 'block');
            $('to-meetings-header').setStyle('display', 'block');
        }
        
    }
    
    function handleMenuResponse (res) {
        var meals = $('to-meals'),
            lunch = $('to-lunch'),
            bkfst = $('to-breakfast'),
            row   = res.table.rows[0];
        if (!row) return;
        
        // 0 (A) Timestamp
        // 1 (B) Username
        // 2 (C) Lunch
        // 3 (D) Breakfast
        // 4 (E) Salad choice
        // 5 (F) Date it applies to
        
        // set lunch and breakfast.
        bkfst.innerText = row.c[3].v;
        lunch.innerText = row.c[2].v;
        
        // if there's a salad choice, append that.
        if (row.c[4].v)
            lunch.innerText += "\n\n" + row.c[4].v + ' salad';
        
        // show these if there's info to put there.
        if (bkfst.innerText || lunch.innerText)
            meals.setStyle('display', 'block');
        
    }

    
    document.addEvent('domready', injectAnnouncementsRequest);
    document.addEvent('domready', injectMealsRequest);
</script>
<style type="text/css">
    * {
        padding: 0;
        margin: 0;
    }
    
    body {
        font-family: 'Open Sans';
        background-color: #333;
    }
    
    #to-sidebar, #to-left {
        height: 100%;
        position: fixed; 
        top: 0;
    }
    
    #to-sidebar {
        float: right;
        width: calc(100% - 920px);
        border-left: 1px solid #111;
        right: 0;
        z-index: 1;
        overflow-y: auto;
        background-color: #fff;
    }
    
    #to-left {
        width: 900px;
        left: 0;
        z-index: 0;
    }
    
    #to-sidebar-logo {
        width: 100%;
        display: block;
    }
    
    .th-sidebar-section {
        padding: 10px;
        display: none;
    }
    
    #to-meals { padding: 0; }
    #to-announcements { display: block; }
    
    #to-sidebar h2 {
        background-color: #d64141;
        padding: 10px;
        color: #fff;
        font-size: 20px;
        display: none;
        height: 25px;
    }
    
    #to-menu-table {
        border-collapse: collapse;
    }
    
    #to-menu-table td {
        padding: 5px 10px;
        width: 50%;
        vertical-align: top;
    }
    
    #to-menu-table th {
        color: #fff;
        text-align: left;
        vertical-align: middle;
        padding: 10px;
        font-size: 20px;
        height: 25px;
    }
    
    #to-breakfast {
        border-right: 1px dashed #ccc;
    }
    
</style>
</head>
    
<body>
    <div id="to-sidebar">
        <img id="to-sidebar-logo" src="header.png" alt="Frontier" />
        
        <h2 id="to-announcements-header">Announcements</h2>
        <div class="th-sidebar-section" id="to-announcements">
            Today's announcements have not yet been posted.
        </div>
        
        <h2 id="to-meetings-header">Meetings</h2>
        <div class="th-sidebar-section" id="to-meetings"></div>
        
        <div class="th-sidebar-section" id="to-meals">
            <table id="to-menu-table">
            <tr style="background-color: #d64141">
                <th>Breakfast</th>
                <th>Lunch</th>
            </tr>
            <tr>
                <td id="to-breakfast"></td>
                <td id="to-lunch"></td>
            </tr>
            </table>
        </div>
    </div>
    <div id="to-left">
        <iframe frameborder="0" noresize="noresize" src="http://www.symbaloo.com/embed/home1982?widget=26&bgcolor=333333" name="_symFrame" width="920px" height="100%"></iframe>
    </div>
</body>
</html>