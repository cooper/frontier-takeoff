<!doctype html>
<html>
<head>
<meta name="studentconfig" contents="{ 'lcs_host': '172.16.1.73', 'lcs_port': 8080, 'channel': 1228, 'change_channel': false, 'allow_prefs': false }" />
<title>Frontier Takeoff</title>
<script type="text/javascript" src="mootools.js"></script>
<link rel="icon" type="image/x-icon" href="favicon.ico" />
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet" type="text/css" />
<script type="text/javascript">
    var announcementsQueryURL = 'https://docs.google.com/a/frontier.k12.in.us/spreadsheets/d/1WdvyXz6LbB12GknlRO0QY8vFHTkCX4zoHkQ6i10Xcfw/gviz/tq?tq=';
    
    // this is basically a trick to avoid using Google's huge APIs for something so simple.
    var google = { visualization: { Query: {
        setResponse: function (res) { handleAnnouncementsResponse(res); } 
    } } };
    
    function injectAnnouncementsRequest () {
        
        // create a query for today's date.
        var d       = new Date();
        var dateStr = d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate();
        var query   = "select * where D=date '"+dateStr+"' order by A desc limit 1";
        
        // inject a script tag for Google's spreadsheet APIs.
        console.log(query);
        var script  = new Element('script', {
            src:  announcementsQueryURL + encodeURIComponent(query),
            type: 'text/javascript'
        });
        document.head.adopt(script);
        
    }
    
    function handleAnnouncementsResponse (res) {
        var announcements = $('to-announcements');
        var giveUp = function (reason) {
            announcements.innerText = reason ? reason :
                "Today's announcements have not yet been published.";
        };
        // consider: if not logged in, this will be a redirect...
        // how will Chrome handle a <script> tag leading to text/html?
        // probably just won't do anything.
        
        // some error occurred.
        if (res.status != 'ok')
            return giveUp('An error occurred.');
        
        // the row will be the first and only row, since the query
        // limits to one result.
        var row = res.table.rows[0];
        if (!row)
            return giveUp();
        
        // 0 (A) Timestamp
        // 1 (B) Announcements
        // 2 (C) Username
        // 3 (D) Date for announcements
        
        // the date is not today.
        if (row.c[3].v.toDateString() != new Date().toDateString())
            return giveUp();
        
        announcements.innerText = parseAnnouncements(row.c[1].v);
    }
    
    // I may need to parse certain formatting if necessary,
    // which will be done here.
    function parseAnnouncements (string) {
        return string;
    }
    
    document.addEvent('domready', injectAnnouncementsRequest);
</script>
<style type="text/css">
    * {
        padding: 0;
        margin: 0;
    }
    
    body {
        font-family: 'Open Sans';
    }
    
    #to-sidebar, #to-left {
        height: 100%;
        position: fixed; 
        top: 0;
    }
    
    #to-sidebar {
        float: right;
        width: calc(100% - 920px);
        border-left: 1px solid #afa0a0;
        right: 0;
        z-index: 1;
        overflow-y: auto;
    }
    
    #to-left {
        width: 900px;
        left: 0;
        z-index: 0;
    }
    
    #to-sidebar-logo {
        width: 100%;
        display: block;
    }
    
    #to-announcements, #to-meetings, #to-meals {
        padding: 10px;
    }
    
    #to-sidebar h2 {
        background-color:  #d64141;
        padding: 10px;
        color: #fff;
        font-size: 20px;
    }
    
</style>
</head>
    
<body>
    <div id="to-sidebar">
        <img id="to-sidebar-logo" src="header.png" alt="Frontier" />
        <h2>Announcements</h2>
        <div id="to-announcements"></div>
        <h2>Meetings</h2>
        <div id="to-meetings">
            SRT Meetings:

Friday: FFA Officers Meeting – A29
National Honor Society Meeting – B7
<br/><br/>
The Fall Sports Athletic Awards Program will be held next week in the Auditorium at 6:00 p.m. The
following sports will be recognized on the designated dates:
<br/><br/>

Monday, November 10: Varsity & Jr. High Football
<br/><br/>

Wednesday, November 12: Cross Country Team
<br/><br/>

Thursday, November 13: Varsity & Jr. High Volleyball
        </div>
        <h2>Meals</h2>
        <div id="to-meals">

            <h3>Breakfast</h3>
                breakfast bacon scramble or variety cereal<br/>
                fruit choice<br/>
                variety fruit juice<br/>
                variety milk
            <h3 style="margin-top: 10px">Lunch</h3>
                orange chicken<br/>
                vegetable fried rice<br/>
                green pepper strips<br/>
                baby carrots<br/>
                applesauce or orange slices
        </div>
    </div>
    <div id="to-left">
        <iframe frameborder="0" noresize="noresize" src="http://www.symbaloo.com/embed/home1982?widget=26&bgcolor=ffffff" name="_symFrame" width="920px" height="100%"></iframe>
    </div>
</body>
</html>